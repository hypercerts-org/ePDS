# ============================================================================
# Magic PDS Configuration
# ============================================================================
# Copy to .env and fill in your values. Run ./scripts/setup.sh to auto-generate
# secrets and install dependencies.

# -- PDS Core --
# Your PDS domain (handles will be <random>.PDS_HOSTNAME)
PDS_HOSTNAME=pds.example
PDS_PORT=3000
PDS_DATA_DIR=./data

# Public URL of the PDS (used as OAuth issuer)
PDS_PUBLIC_URL=https://pds.example

# AT Protocol network settings
PDS_DID_PLC_URL=https://plc.directory
PDS_BSKY_APP_VIEW_URL=https://api.bsky.app
PDS_BSKY_APP_VIEW_DID=did:web:api.bsky.app
PDS_CRAWLERS=https://bsky.network

# PDS secrets (auto-generated by setup.sh)
PDS_JWT_SECRET=
PDS_DPOP_SECRET=
PDS_ADMIN_PASSWORD=

# PLC rotation key (secp256k1 private key as hex)
# Generate with:
#   openssl ecparam -name secp256k1 -genkey -noout | openssl ec -text -noout 2>/dev/null | grep priv -A 3 | tail -n +2 | tr -d '[:space:]:'
PDS_PLC_ROTATION_KEY_K256_PRIVATE_KEY_HEX=

# -- Auth Service --
# Subdomain for the auth UI (must be a subdomain of PDS_HOSTNAME)
AUTH_HOSTNAME=auth.pds.example
AUTH_PORT=3001

# Auth service secrets (auto-generated by setup.sh)
AUTH_SESSION_SECRET=
AUTH_CSRF_SECRET=

# -- Magic Link --
# How long magic links are valid (minutes)
MAGIC_LINK_EXPIRY_MINUTES=10
# Full URL to the magic link verification endpoint
MAGIC_LINK_BASE_URL=https://auth.pds.example/auth/verify

# Shared HMAC-SHA256 secret between auth-service and pds-core.
# Signs the /oauth/magic-callback redirect URL so pds-core can verify the
# redirect was produced by a legitimate auth flow (not forged by an attacker
# who obtained a valid request_uri).
# Generate with: openssl rand -hex 32
# MUST match in both services. Required in production.
MAGIC_CALLBACK_SECRET=

# Shared secret for internal service-to-service calls (auth-service → pds-core).
# Used to authenticate /_internal/account-by-email requests.
# Generate with: openssl rand -hex 32
# MUST match in both services. Required in production.
MAGIC_INTERNAL_SECRET=

# -- Better Auth --
# Session lifetime in seconds (default 7 days)
SESSION_EXPIRES_IN=604800
# Session update age in seconds (default 1 day)
SESSION_UPDATE_AGE=86400

# Social providers (both vars must be set to enable a provider)
# When set, social login buttons appear on the login page.
# The flow: social OAuth → better-auth session → /auth/complete bridge →
# HMAC-signed redirect to /oauth/magic-callback → AT Protocol authorization code.
#
# Account linking: if the social provider email matches an existing PDS account,
# the user is logged in to that account. If not, a new PDS account is created.
# Use the same email for both PDS registration and social provider to ensure
# accounts are linked correctly.
#
# Google OAuth credentials: https://console.cloud.google.com/
# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=
#
# GitHub OAuth credentials: https://github.com/settings/developers
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=

# -- Email --
# Provider: smtp, sendgrid, ses, or postmark
# All providers use SMTP under the hood via nodemailer.
#
# smtp     - Generic SMTP (set SMTP_HOST/PORT/USER/PASS)
# sendgrid - Uses smtp.sendgrid.net (set SENDGRID_API_KEY)
# ses      - Uses AWS SES SMTP (set AWS_SES_SMTP_USER/PASS, optionally AWS_REGION)
# postmark - Uses smtp.postmarkapp.com (set POSTMARK_SERVER_TOKEN)
EMAIL_PROVIDER=smtp

# SMTP settings (for EMAIL_PROVIDER=smtp, or as overrides for other providers)
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USER=
SMTP_PASS=

# SendGrid (EMAIL_PROVIDER=sendgrid)
# SENDGRID_API_KEY=SG.xxxxx

# AWS SES SMTP (EMAIL_PROVIDER=ses)
# Generate SMTP credentials at: AWS Console > SES > SMTP Settings
# AWS_REGION=us-east-1
# AWS_SES_SMTP_USER=
# AWS_SES_SMTP_PASS=

# Postmark (EMAIL_PROVIDER=postmark)
# POSTMARK_SERVER_TOKEN=

# Sender address and name
SMTP_FROM=noreply@pds.example
SMTP_FROM_NAME=My PDS

# -- Blobstore --
# Where to store uploaded blobs (images, etc.)
# Use disk for local/small deployments, S3 for production
PDS_BLOBSTORE_DISK_LOCATION=./data/blobs

# -- Database --
# Path to the magic-pds SQLite database (separate from PDS account.sqlite)
DB_LOCATION=./data/magic-pds.sqlite

# -- Docker/Caddy --
# Override reverse proxy upstreams (for non-Docker or custom setups)
# PDS_UPSTREAM=pds:3000
# AUTH_UPSTREAM=auth:3001

# -- Runtime --
# Set to 'development' for dev mode (disables secure cookies, etc.)
# NODE_ENV=development
# PDS_DEV_MODE=true
